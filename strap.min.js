!function(t,i){"use strict";function n(t){this._config=s,this._window=!1,this._poller=!1,this._winOpen=!1,this._isConnected=!1,this._platform="",this._setConfig(t),this.init()}var o="https://api.curanexus.co",s={token:"",guid:"",debug:0};t.extend(n.prototype,{init:function(){this._config.guid&&this._validate()},status:function(){return this._isConnected},platform:function(){return this._platform},connect:function(t){t&&this.setGuid(t),this._checkData()&&(this._window=i.open(this._buildURL("connect"),"Strap","width=380,height=500,scrollbars=yes"),this._poll(),this._winChecker())},disconnect:function(t){t&&this.setGuid(t),this._checkData()&&(this._window=i.open(this._buildURL("disconnect"),"Strap","width=380,height=500,scrollbars=yes"),setTimeout(this._validate.bind(this),2e3))},validate:function(t){t&&this.setGuid(t),this._validate()},setGuid:function(t){t?this._setConfig({guid:t}):this._onError("Missing Guid ")},log:function(){if(this._config.debug){var t=Array.slice(arguments);console.log(t)}},on:function(t,i){switch(t){case"cancel":this._onCancel=i?i:this._onCancel;break;case"connect":this._onConnect=i?i:this._onConnect;break;case"error":this._onError=i?i:this._onError;break;case"status":this._onStatus=i?i:this._onStatus}},_validate:function(){this._checkData()&&t.getJSON(this._buildURL("check"),this._validator.bind(this))},_validator:function(t){this._isConnected=t.success||!1,this._platform=t.platform||"",this._onStatus({connect:this._isConnected,platform:this._platform})},_poll:function(){this.log("Poll"),t.getJSON(this._buildURL("check"),this._pollResponse.bind(this))},_pollResponse:function(t){this._isConnected=t.success||!1,this._platform=t.platform||"",this._isConnected?(this.log("Poll Done"),this._isConnected&&this._onConnect(),this._onStatus({connect:this._isConnected,platform:this._platform}),this._stopPoller()):(this.log("Poll Again"),this._poller=setTimeout(this._poll.bind(this),3e3))},_stopPoller:function(){this.log("Poll Killed"),clearTimeout(this._poller)},_winChecker:function(){null==this._window||this._window.closed?(this.log("Check Window: Closed"),this._poller&&!this._isConnected&&this._onCancel(),this._stopPoller(),clearTimeout(this._winOpen)):(this.log("Check Window: Open"),this._winOpen=setTimeout(this._winChecker.bind(this),1e3))},_onCancel:function(t){this.log("Cancel",t)},_onConnect:function(t){this.log("Connect",t)},_onError:function(t){this.log("Error",t)},_onStatus:function(t){this.log("Status",t)},_checkData:function(){return this._config.token?this._config.guid?!0:(this._onError("Missing guid"),!1):(this._onError("Missing token"),!1)},_setConfig:function(i){this._config=t.extend({},this._config,i)},_Close:function(){this._window.close()},_buildURL:function(t){return o+"/"+t+"?token="+this._config.token+"&guid="+escape(this._config.guid)}}),t.strap=function(t){return new n(t)}}(jQuery,window,document);